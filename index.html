<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interfaz Vertical para Videos de YouTube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .phone-container {
            width: 100%;
            height: 100%;
            max-width: 420px;
            max-height: 85vh;
            border-radius: 24px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            border: 2px solid #333;
            background-color: #000;
        }
        #video-feed {
            height: 100%;
            width: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        #video-feed::-webkit-scrollbar { display: none; }
        .video-container {
            height: 100%;
            width: 100%;
            scroll-snap-align: start;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            animation: fadeIn 0.5s ease-in-out;
        }
        .video-iframe-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .video-iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .overlay-gradient {
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 30%, rgba(0,0,0,0) 60%);
            pointer-events: none;
        }
        .overlay-content {
             pointer-events: auto;
        }
        #loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        .action-button {
            transition: transform 0.2s ease-in-out;
        }
        .action-button:hover {
            transform: scale(1.1);
        }
        .description-text {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
            text-overflow: ellipsis;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 480px) {
            .phone-container {
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
                border: none;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <main id="video-feed">
            <!-- Los videos se insertarán aquí dinámicamente -->
        </main>
        <!-- Contenedor para mostrar errores -->
        <div id="error-message" class="hidden absolute inset-0 flex flex-col justify-center items-center p-4 text-center bg-black bg-opacity-80">
            <h2 class="text-lg font-bold text-red-500">¡Ups! Algo salió mal.</h2>
            <p class="text-sm text-gray-300 mt-2" id="error-details"></p>
            <button onclick="location.reload()" class="mt-4 bg-white text-black font-bold py-2 px-4 rounded">Reintentar</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const videoFeed = document.getElementById('video-feed');
            let isLoading = false;

            const createVideoElement = (videoData) => {
                const container = document.createElement('div');
                container.className = 'video-container';
                const iframeSrc = `https://www.youtube.com/embed/${videoData.videoId}?autoplay=1&mute=1&loop=1&playlist=${videoData.videoId}&controls=0&showinfo=0&modestbranding=1`;
                
                container.innerHTML = `
                    <div class="video-iframe-container">
                        <iframe src="${iframeSrc}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                    </div>
                    <div class="absolute inset-0 flex flex-col justify-end p-4 overlay-gradient">
                        <div class="flex items-end overlay-content">
                            <!-- Columna de información del video -->
                            <div class="flex-grow">
                                <h3 class="font-bold text-lg">${videoData.title}</h3>
                                <p class="text-sm mt-1 description-text">${videoData.description || 'Sin descripción.'}</p>
                            </div>
                            <!-- Columna de botones de acción -->
                            <div class="flex flex-col items-center space-y-6 ml-4">
                                <button class="action-button text-center">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                                </button>
                                <button class="action-button text-center">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.02-3.06A8.009 8.009 0 012 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM4.416 14.616l.043.028a6.023 6.023 0 003.499 1.022 6 6 0 10-5.9-7.965 5.986 5.986 0 001.32 3.699l.028.043-1.002 3.006 3.012-1.002z" clip-rule="evenodd"></path></svg>
                                </button>
                                <button class="action-button text-center">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                return container;
            };

            const showLoading = () => {
                const loadingContainer = document.createElement('div');
                loadingContainer.className = 'video-container';
                loadingContainer.id = 'loading-container';
                loadingContainer.innerHTML = `<div id="loading-spinner"></div>`;
                videoFeed.appendChild(loadingContainer);
            };

            const hideLoading = () => {
                const loadingContainer = document.getElementById('loading-container');
                if (loadingContainer) {
                    loadingContainer.remove();
                }
            };

            const showError = (message) => {
                const errorMessageContainer = document.getElementById('error-message');
                const errorDetails = document.getElementById('error-details');
                errorDetails.textContent = message;
                errorMessageContainer.classList.remove('hidden');
            };

            const loadNextVideo = async () => {
                if (isLoading) return;
                isLoading = true;
                showLoading();

                try {
                    const response = await fetch('/api/get-random-video');
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Error del servidor: ${response.statusText}`);
                    }
                    
                    const videoData = await response.json();
                    if (videoData.error) {
                        throw new Error(videoData.error);
                    }

                    const videoElement = createVideoElement(videoData);
                    
                    hideLoading();
                    videoFeed.appendChild(videoElement);

                } catch (error) {
                    console.error("No se pudo cargar el video:", error);
                    hideLoading();
                    showError(`No se pudo conectar con el servidor. Revisa los registros de la función en Netlify. (${error.message})`);
                } finally {
                    isLoading = false;
                }
            };

            videoFeed.addEventListener('scroll', () => {
                const { scrollTop, scrollHeight, clientHeight } = videoFeed;
                if (scrollTop + clientHeight >= scrollHeight - 5) {
                    loadNextVideo();
                }
            });

            loadNextVideo();
        });
    </script>
</body>
</html>
